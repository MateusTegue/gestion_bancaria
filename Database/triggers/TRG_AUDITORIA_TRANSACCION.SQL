CREATE OR REPLACE TRIGGER PROYECTODB.TRG_AUDITORIA_TRANSACCION
AFTER INSERT ON PROYECTODB.TBL_TRANSACCIONES
FOR EACH ROW
DECLARE
    v_usuario_id NUMBER;
BEGIN
    -- Buscar el usuario relacionado con la cuenta de la transacción
    SELECT u.USUARIO_ID
      INTO v_usuario_id
      FROM PROYECTODB.TBL_USUARIOS u
      JOIN PROYECTODB.TBL_CUENTAS c ON c.CLIENTE_ID = u.USUARIO_ID
     WHERE c.CUENTA_ID = :NEW.CUENTA_ID;

    -- Insertar registro en auditoría
    INSERT INTO PROYECTODB.TBL_AUDITORIA_TRANSACCIONES 
        (AUDITORIA_ID, TRANSACCION_ID, USUARIO_ID, FECHA_OPERACION)
    VALUES (
        PROYECTODB.SEQ_AUDITORIA_ID.NEXTVAL,
        :NEW.TRANSACCION_ID,
        v_usuario_id,
        SYSDATE
    );
END;


INSERT INTO PROYECTODB.TBL_TRANSACCIONES (TRANSACCION_ID, CUENTA_ID, TIPO_TRANSACCION_ID, MONTO, FECHA_TRANSACCION)
VALUES (4002, 'CUENTA_0438', 7, 9908888888000.00, SYSDATE);